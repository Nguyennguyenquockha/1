local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

local boostGui
local enforceConnection
local boostBtn
local boostAktif = false
local DEFAULT_WALKSPEED = 16

-- Kéo chính xác mobile + PC
local function enableDragging(frame)
	local dragging, dragInput, dragStart, startPos

	local function update(input)
		local delta = input.Position - dragStart
		local newPosition = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
		frame.Position = newPosition
	end

	frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	frame.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if dragging and input == dragInput then
			update(input)
		end
	end)
end

local function startEnforceSpeed()
	local character = player.Character or player.CharacterAdded:Wait()
	local humanoid = character:WaitForChild("Humanoid")

	if enforceConnection then enforceConnection:Disconnect() end

	enforceConnection = RunService.Heartbeat:Connect(function()
		if humanoid.WalkSpeed ~= 42 then
			humanoid.WalkSpeed = 42
		end
	end)

	humanoid:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
		if boostAktif and humanoid.WalkSpeed ~= 42 then
			humanoid.WalkSpeed = 42
		end
	end)

	humanoid.WalkSpeed = 42
end

local function stopEnforceSpeed()
	if enforceConnection then
		enforceConnection:Disconnect()
		enforceConnection = nil
	end

	local char = player.Character
	if char then
		local hum = char:FindFirstChildOfClass("Humanoid")
		if hum then
			hum.WalkSpeed = DEFAULT_WALKSPEED
		end
	end
end

local function buatBoostGUI()
	if boostGui then return end

	boostGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
	boostGui.Name = "BoostGUI"
	boostGui.ResetOnSpawn = false

	boostBtn = Instance.new("TextButton", boostGui)
	boostBtn.Size = UDim2.new(0, 96, 0, 32)
	boostBtn.Position = UDim2.new(0.5, 0, 1, -70)
	boostBtn.AnchorPoint = Vector2.new(0.5, 1)
	boostBtn.BackgroundColor3 = Color3.fromRGB(0, 85, 170)
	boostBtn.TextColor3 = Color3.new(1, 1, 1)
	boostBtn.Font = Enum.Font.FredokaOne
	boostBtn.TextSize = 17
	boostBtn.BorderSizePixel = 0
	boostBtn.AutoButtonColor = false
	boostBtn.Text = "Boost OFF"

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 10)
	corner.Parent = boostBtn

	local stroke = Instance.new("UIStroke")
	stroke.Color = Color3.fromRGB(0, 200, 255)
	stroke.Thickness = 2
	stroke.Transparency = 0.1
	stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	stroke.Parent = boostBtn

	-- Âm thanh click
	local clickSound = Instance.new("Sound")
	clickSound.SoundId = "rbxassetid://9080070218"
	clickSound.Volume = 1
	clickSound.Parent = boostBtn

	enableDragging(boostBtn)

	boostBtn.MouseButton1Click:Connect(function()
		clickSound:Play()
		boostAktif = not boostAktif

		local tweenUp = TweenService:Create(boostBtn, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
			Size = UDim2.new(0, 106, 0, 38)
		})
		local tweenDown = TweenService:Create(boostBtn, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
			Size = UDim2.new(0, 96, 0, 32)
		})
		tweenUp:Play()
		tweenUp.Completed:Connect(function()
			tweenDown:Play()
		end)

		if boostAktif then
			boostBtn.Text = "Boost ON"
			startEnforceSpeed()
		else
			boostBtn.Text = "Boost OFF"
			stopEnforceSpeed()
		end
	end)
end

-- Khởi tạo
buatBoostGUI()

-- Nếu nhân vật chết rồi hồi sinh, giữ lại trạng thái boost
player.CharacterAdded:Connect(function()
	if boostAktif then
		startEnforceSpeed()
	else
		stopEnforceSpeed()
	end
end)